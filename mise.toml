# ========================================
# Claude Code Marketplace - mise設定
# ========================================

# ========================================
# ツール管理
# ========================================

[tools]
node = "24"
fd = 'latest'
yamllint = 'latest'
"npm:prettier" = '3.6.2'
"npm:markdownlint-cli2" = 'latest'
"npm:markdown-link-check" = 'latest'
taplo = 'latest'

# ========================================
# コマンド（実際の処理を行うタスク）
# ========================================

# --- Format Commands ---
[tasks."format:prettier"]
description = "Prettierでフォーマット"
run = "prettier --write --cache --log-level warn '**/*.{md,json,yml,yaml}'"

[tasks."format:markdown"]
description = "Markdownlintで自動修正"
run = "markdownlint-cli2 --fix \"**/*.md\" \"#**/node_modules/**\""

[tasks."format:toml"]
description = "TOMLファイルをフォーマット"
run = "taplo format"

# --- Lint Commands ---
[tasks."lint:prettier"]
description = "Prettierでチェック"
run = "prettier --check --cache --log-level warn '**/*.{md,json,yml,yaml}'"

[tasks."lint:markdown"]
description = "Markdownlintでチェック"
run = "markdownlint-cli2 \"**/*.md\" \"#**/node_modules/**\""

[tasks."lint:yaml"]
description = "YAMLファイルをチェック"
run = "yamllint -f parsable ."

[tasks."lint:toml"]
description = "TOMLファイルをチェック"
run = "taplo lint"

[tasks."lint:links"]
description = "Markdownリンクチェック（個別実行推奨・時間がかかるため）"
run = "fd -e md -t f '' . -E node_modules -X markdown-link-check -c .markdown-link-check.json -q"

# --- Git Submodule Commands ---
[tasks."submodule:update"]
description = "サブモジュールを最新に更新"
run = "git submodule update --remote --merge"

[tasks."submodule:init"]
description = "サブモジュールを初期化（クローン後の初回のみ）"
run = "git submodule update --init --recursive"

# --- Plugin Management Commands ---
[tasks."plugin:generate"]
description = "plugin.jsonのskills配列をディレクトリ構造から自動生成"
run = "bun run scripts/generate-plugin-json.ts"

[tasks."plugin:generate:dry-run"]
description = "plugin.json変更内容をプレビュー（書き込みなし）"
run = "bun run scripts/generate-plugin-json.ts --dry-run"

# ========================================
# 集約タスク（まとめ実行のショートカット）
# ========================================

[tasks.format]
description = "すべてのフォーマットを実行（並列）"
depends = ["format:prettier", "format:markdown", "format:toml"]

[tasks.lint]
description = "すべてのlintを実行（並列・links除く）"
depends = ["lint:prettier", "lint:markdown", "lint:yaml", "lint:toml"]

[tasks."lint:all"]
description = "すべてのlintを実行（リンクチェック含む）"
depends = ["lint", "lint:links"]

[tasks.ci]
description = "CI相当のチェックをまとめて実行"
depends = ["format", "lint"]
run = "echo '✅ CI checks completed'"

[tasks."+all"]
description = "すべてのチェックを実行（リンクチェック含む）"
depends = ["format", "lint:all"]
run = "echo '✅ All checks completed'"
